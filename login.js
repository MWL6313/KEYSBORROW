const loginBtn = document.getElementById("loginBtn");
const msg = document.getElementById("msg");
const loading = document.getElementById("loading");



loginBtn.addEventListener("click", async () => {
  const account = document.getElementById("account").value.trim();
  const password = document.getElementById("password").value;

  msg.innerText = "";
  msg.classList.remove("shake");

  if (!account || !password) {
    msg.innerText = "請輸入帳號與密碼";
    msg.classList.add("shake");
    return;
  }

  loading.style.display = "block";
  loginBtn.disabled = true;

  try {
    // ✅ 若帳號在白名單中，就直接登入（不呼叫後端）
    if (localAccounts[account] && localAccounts[account] === password) {
      localStorage.setItem("authToken", `local-${account}`);
      document.body.classList.add("fade-out");
      setTimeout(() => {
        location.href = "dashboard.html";
      }, 500);
      return;
    }

    // 否則呼叫後端 API 驗證（admin / manager 走這邊）
    const res = await fetch("https://key-loan-api-978908472762.asia-east1.run.app/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ account, password }),
    });
    const data = await res.json();

    if (data.success) {
      localStorage.setItem("authToken", data.token);
      document.body.classList.add("fade-out");
      setTimeout(() => {
        location.href = "dashboard.html";
      }, 500);
    } else {
      msg.innerText = "登入失敗，請檢查帳密";
      msg.classList.add("shake");
    }
  } catch (error) {
    console.error(error);
    msg.innerText = "發生錯誤，請稍後再試。";
    msg.classList.add("shake");
  } finally {
    loading.style.display = "none";
    loginBtn.disabled = false;
  }
});

// ✅ 前端帳號密碼白名單（不具 admin 或 manager 權限）
const localAccounts = {
  "N000035788 錢俊銘": "3072",
  "N000035909 李育杰": "3071",
  "N000036579 林忠輝": "3077",
  "N000036824 鄞正霖": "3005",
  "N000036831 周念宗": "3198",
  "N000036852 尤志展": "3073",
  "N000037230 吳明福": "0000",
  "N000037231 陳憲明": "3100",
  "N000037303 詹賴泳": "3045",
  "N000037439 王擎天": "3114",
  "N000037548 林瑞文": "3065",
  "N000037882 翁維廷": "3468",
  "N000037883 李權展": "3477",
  "N000038536 謝智仁": "3464",
  "N000038537 洪國展": "3466",
  "N000038547 古家豪": "3069",
  "N000038921 戴松興": "3034",
  "N000038924 黃鈞麟": "3120",
  "N000038925 黃宏嘉": "3067",
  "N000038926 李明洲": "3128",
  "N000039301 黃舜麟": "3470",
  "N000039303 孫繼偉": "3475",
  "N000039306 蔡孟駿": "3472",
  "N000039308 沈國志": "3479",
  "N000039315 夏寶生": "3469",
  "N000039316 林溪川": "3473",
  "N000039317 廖志銘": "3459",
  "N000039372 楊賢文": "3099",
  "N000039726 羅文進": "3025",
  "N000039731 楊文芳": "3040",
  "N000039972 張詠欽": "3006",
  "N000039977 蔡炯文": "3068",
  "N000040613 丁三益": "3126",
  "N000041291 陳欽賓": "6666",
  "N000041292 張立昌": "3424",
  "N000041295 陳慶裕": "3454",
  "N000041304 廖國杉": "3449",
  "N000041305 梁建業": "3458",
  "N000041311 蔡享岳": "3450",
  "N000041312 張哲欣": "3414",
  "N000041317 洪國書": "3457",
  "N000041319 許芳遠": "3460",
  "N000041322 顏嘉俊": "3437",
  "N000041347 侯登峰": "3430",
  "N000041351 李謀穎": "3418",
  "N000041590 林炳成": "3135",
  "N000041591 吳嘉益": "3145",
  "N000041592 林東生": "3113",
  "N000041598 李榮烈": "3169",
  "N000041875 尤昭建": "3165",
  "N000041876 鄭福仁": "3062",
  "N000042047 葉于謙": "3015",
  "N000042052 陳振龍": "3404",
  "N000042053 林添丁": "3649",
  "N000042058 李文明": "3417",
  "N000042062 蔡武郎": "3121",
  "N000042835 林政憲": "3035",
  "N000042836 丁志彬": "3030",
  "N000042839 羅克誠": "3125",
  "N000042841 江昌桂": "3029",
  "N000042846 張明福": "3049",
  "N000043064 蘇誌櫳": "3644",
  "N000043069 盧偉銘": "3659",
  "N000043076 伍寶富": "3634",
  "N000043120 周明山": "3014",
  "N000043232 李權欽": "3047",
  "N000043290 陳岳飛": "3051",
  "N000043390 張博仁": "3079",
  "N000043395 蔡瀗慶": "3408",
  "N000043417 溫世吉": "3635",
  "N000043418 陳鏗文": "3124",
  "N000043438 曾圭仁": "3052",
  "N000043546 邱仁舜": "3141",
  "N000044190 陳清水": "3026",
  "N000044191 王志家": "3048",
  "N000044192 黃瑞峰": "3019",
  "N000044195 劉坤地": "3082",
  "N000044196 吳錦郎": "3053",
  "N000044197 王敏正": "3020",
  "N000044199 許盛章": "3054",
  "N000044523 林明彥": "0000",
  "N000044526 張道祐": "3118",
  "N000044922 洪進達": "3119",
  "N000045168 張朝閣": "3038",
  "N000045169 陳學文": "3127",
  "N000045172 曾茂全": "3153",
  "N000045242 李鴻霖": "1159",
  "N000045315 黃嘉龍": "3148",
  "N000045316 黃國平": "3122",
  "N000045317 吳建誠": "3158",
  "N000045319 石殷銘": "3091",
  "N000045320 林家合": "3101",
  "N000045321 林鴻斌": "3132",
  "N000046239 蘇仕東": "3379",
  "N000046241 沈益州": "3130",
  "N000046243 張博聞": "3095",
  "N000046244 李政憲": "3102",
  "N000046246 蕭思文": "3129",
  "N000046247 李振宏": "3162",
  "N000046515 謝坤陵": "3215",
  "N000046519 鄭惠麟": "3191",
  "N000046521 賴春霖": "3200",
  "N000046798 李哲瑋": "3218",
  "N000047383 賴德": "3085",
  "N000047883 許翔傑": "3089",
  "N000047884 陳光茂": "3186",
  "N000047885 廖健村": "3196",
  "N000047886 楊夢華": "3187",
  "N000047887 蔡勝欽": "3088",
  "N000050486 林源証": "3172",
  "N000050487 李群銘": "3170",
  "N000050489 雷晉易": "3180",
  "N000050496 林世豐": "3183",
  "N000050497 朱信昌": "3184",
  "N000050937 王耀輝": "3665",
  "N000051547 張創閔": "3208",
  "N000051548 許順良": "3207",
  "N000051549 翁明瑞": "3213",
  "N000051553 莊一志": "3209",
  "N000052673 李育全": "3671",
  "N000052749 林宗吉": "3226",
  "N000052753 胡哲彰": "3044",
  "N000052754 劉慶才": "3235",
  "N000052756 林志信": "3123",
  "N000052757 吳景輝": "3221",
  "N000052758 謝順溢": "3222",
  "N000053419 丁秋水": "3486",
  "N000054150 林廷騏": "3232",
  "N000054154 葉龍一": "3237",
  "N000054155 洪榮聰": "3231",
  "N000056280 朱修德": "3258",
  "N000056281 楊文正": "3247",
  "N000056284 吳福元": "3253",
  "N000056297 黃棋鋒": "3254",
  "N000056950 賴慶龍": "3275",
  "N000056953 黃建雄": "3282",
  "N000056954 廖東耀": "3273",
  "N000056956 劉清潭": "3278",
  "N000056957 林鴻昇": "3280",
  "N000060100 許見安": "3494",
  "N000060101 林國智": "3495",
  "N000060102 吳宜哲": "3491",
  "N000060105 許方瑋": "3489",
  "N000060303 鍾志杰": "3285",
  "N000060306 葉啟明": "3310",
  "N000060312 吳樹林": "3302",
  "N000060316 王錦賢": "3307",
  "N000060318 許林貴": "3296",
  "N000060319 陳建亨": "3297",
  "N000060323 吳志強": "3306",
  "N000061370 吳忠信": "3323",
  "N000061373 黃明賢": "3328",
  "N000061380 吳嘉雄": "3317",
  "N000061383 黃宗仁": "3330",
  "N000063123 程谷峰": "3331",
  "N000068187 林嘉慶": "3341",
  "N000068192 蔡金敏": "3335",
  "N000068193 林建安": "3336",
  "N000068195 張朝宗": "3333",
  "N000068196 許榮杉": "3338",
  "N000069441 王國郎": "3688",
  "N000069444 黃建斌": "3691",
  "N000069445 黃勝賢": "3689",
  "N000069446 張俊明": "3685",
  "N000069450 李銘溯": "3678",
  "N000069451 蔡安平": "3679",
  "N000069452 張志誠": "3680",
  "N000069453 廖昌保": "3684",
  "N000070255 林方延": "3360",
  "N000070852 謝銘松": "3355",
  "N000070854 張學泉": "3352",
  "N000070855 廖彥鈞": "3361",
  "N000072701 吳志峰": "3365",
  "N000072702 廖秋順": "3376",
  "N000072703 鄭文榮": "3364",
  "N000072713 蔡福俊": "3362",
  "N000082493 張明賓": "3384",
  "N000082494 吳律衛": "3385",
  "N000082495 陳江河": "3380",
  "N000082496 許欽貴": "3381",
  "N000082498 許董養": "3387",
  "N000082503 陳俊琪": "3389",
  "N000082504 呂宥達": "3392",
  "N000083957 吳孟洲": "3703",
  "N000084703 余吉長": "3720",
  "N000084705 曹清池": "3714",
  "N000086908 廖柏達": "3723",
  "N000086909 施鑫毅": "3725",
  "N000086910 吳禮熹": "3724",
  "N000086911 莊淯瀚": "3721",
  "N000086912 邱威澤": "3722",
  "N000086913 許瑞彬": "3726",
  "N000088121 周聰寶": "3886",
  "N000088125 蔡建智": "3890",
  "N000088127 陳冠良": "3742",
  "N000089030 周信宏": "3695",
  "N000089032 周畯宏": "3696",
  "N000094472 吳文展": "3922",
  "N000094575 郭舜傑": "1122",
  "N000099422 陳建勝": "3375",
  "N000150284 蔡孟軒": "3400",
  "N000150285 黃瑞坤": "3399",
  "N000150287 洪家俊": "3397",
  "N000193123 丁瑞彥": "3407",
  "N000193151 林帟絃": "3410",
  "N000193237 李驊紘": "3413",
  };
// 初始化帳號下拉選單
const accountList = document.getElementById("accountList");
Object.keys(localAccounts).forEach((acc) => {
  const option = document.createElement("option");
  option.value = acc;
  accountList.appendChild(option);
});
